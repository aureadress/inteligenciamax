<div style="text-align:center; margin-top:40px;">
  <h2>Conecte o sistema ao WhatsApp Web</h2>
  <div
    id="qrContainer"
    style="width:300px;height:300px;margin:20px auto;border:3px solid #ccc;background:#fff;"
  >
    <p id="qrText" style="margin-top:120px;color:red;">Carregando...</p>
  </div>

  <button id="connectBtn">Conectar</button>
  <button id="disconnectBtn">Desconectar</button>
  <button id="resetBtn">Resetar Conexão</button>
</div>

<script>
  const backend = "https://inteligencia-max-backend-production.up.railway.app";

  async function loadQR() {
    const qrContainer = document.getElementById("qrContainer");
    const qrText = document.getElementById("qrText");
    try {
      const res = await fetch(`${backend}/qr`);
      if (!res.ok) {
        qrContainer.innerHTML =
          "<p style='color:red;margin-top:120px;'>Aguardando QR Code...</p>";
        return;
      }
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      qrContainer.innerHTML = `<img src="${url}" width="300" height="300">`;
    } catch {
      qrText.innerText = "Erro ao carregar QR Code.";
    }
  }

  document.getElementById("connectBtn").onclick = async () => {
    await fetch(`${backend}/connect`);
    loadQR();
  };

  document.getElementById("disconnectBtn").onclick = async () => {
    await fetch(`${backend}/disconnect`);
    alert("Conexão encerrada!");
  };

  document.getElementById("resetBtn").onclick = async () => {
    await fetch(`${backend}/reset`);
    alert("Sessão resetada!");
    loadQR();
  };

  setInterval(loadQR, 10000);
  loadQR();
</script>
